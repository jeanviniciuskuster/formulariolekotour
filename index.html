<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inscrição Transporte Escolar</title>
    <link rel="stylesheet" href="style.css" />

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
  </head>
  <body>
    <form id="formulario">
      <div class="div-neon-branca">
        <div class="titulo">
          <h1>LekoTour</h1>
          <p>Formulário de Inscrição</p>
          <p>Transporte universitário</p>
          <p>SÃO JOSÉ DOS PINHAIS A CURITIBA</p>
        </div>

        <div class="card">
          <input type="text" name="nome" placeholder="Nome Completo" required />
          <span></span>
        </div>
        <div class="card">
          <input type="tel" name="telefone" placeholder="Telefone" required />
          <span></span>
        </div>
        <div class="card">
          <input
            type="date"
            name="dataDeNascimento"
            placeholder="Data de Nascimento"
            required
          />
          <span></span>
        </div>

        <div class="card">
          <input type="email" name="email" placeholder="Email" required />
          <span></span>
        </div>

        <div class="card">
          <input
            type="text"
            name="cpf"
            placeholder="Cpf"
            required
            autocomplete="off"
          />
          <span></span>
        </div>
        <div class="card">
          <input
            type="text"
            name="rg"
            placeholder="Rg"
            required
            autocomplete="off"
          />
          <span></span>
        </div>
        <div class="card">
          <input type="text" name="cep" placeholder="Cep" required />
          <span></span>
        </div>
        <div class="card">
          <input type="text" name="endereco" placeholder="Endereço" required />
          <span></span>
        </div>
        <div class="card">
          <input type="text" name="numero" placeholder="N°" required />
          <span></span>
        </div>
        <div class="card">
          <input type="text" name="bairro" placeholder="Bairro" required />
          <span></span>
        </div>
        <div class="card">
          <input type="text" name="cidade" placeholder="Cidade" required />
          <span></span>
        </div>

        <div class="card">
          <select name="tipoDeTrajeto" required>
            <option value="">Tipo De Trajeto</option>
            <option value="ida">Somente Ida</option>
            <option value="volta">Somente Volta</option>
            <option value="ida-e-volta">Ida e Volta</option>
          </select>
          <span></span>
        </div>

        <div class="card">
          <input
            type="text"
            name="localDeEmbarque"
            placeholder="Local de Embarque"
            required
          />
          <span></span>
        </div>

        <div class="card">
          <input
            type="text"
            name="localDeDestino"
            placeholder="Local de Destino"
            required
          />
          <span></span>
        </div>

        <div class="card">
          <label>
            Início do Contrato
            <div style="display: flex; gap: 8px; margin-top: 4px">
              <select name="diaInicio" required>
                <option value="">Dia</option>
                <script>
                  for (let i = 1; i <= 31; i++) {
                    document.write(
                      `<option value="${String(i).padStart(2, "0")}">${String(
                        i
                      ).padStart(2, "0")}</option>`
                    );
                  }
                </script>
              </select>

              <select name="mesInicio" required>
                <option value="">Mês</option>
                <option value="01">Janeiro</option>
                <option value="02">Fevereiro</option>
                <option value="03">Março</option>
                <option value="04">Abril</option>
                <option value="05">Maio</option>
                <option value="06">Junho</option>
                <option value="07">Julho</option>
                <option value="08">Agosto</option>
                <option value="09">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>

              <select name="anoInicio" required>
                <option value="">Ano</option>
                <script>
                  const currentYear = new Date().getFullYear();
                  for (let i = currentYear; i <= currentYear + 6; i++) {
                    // Próximos 6 anos
                    document.write(`<option value="${i}">${i}</option>`);
                  }
                </script>
              </select>
            </div>
          </label>

          <label>
            Fim do Contrato
            <div style="display: flex; gap: 8px; margin-top: 4px">
              <select name="diaFim" required>
                <option value="">Dia</option>
                <script>
                  for (let i = 1; i <= 31; i++) {
                    document.write(
                      `<option value="${String(i).padStart(2, "0")}">${String(
                        i
                      ).padStart(2, "0")}</option>`
                    );
                  }
                </script>
              </select>

              <select name="mesFim" required>
                <option value="">Mês</option>
                <option value="01">Janeiro</option>
                <option value="02">Fevereiro</option>
                <option value="03">Março</option>
                <option value="04">Abril</option>
                <option value="05">Maio</option>
                <option value="06">Junho</option>
                <option value="07">Julho</option>
                <option value="08">Agosto</option>
                <option value="09">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>

              <select name="anoFim" required>
                <option value="">Ano</option>
                <script>
                  // Replicar a lógica do ano de início para consistência
                  const currentYearEnd = new Date().getFullYear();
                  for (let i = currentYearEnd; i <= currentYearEnd + 6; i++) {
                    document.write(`<option value="${i}">${i}</option>`);
                  }
                </script>
              </select>
            </div>
          </label>
          <span></span>
        </div>

        <div class="card">
          <label>
            Horário de Entrada
            <div style="display: flex; gap: 8px; margin-top: 4px">
              <select name="horaEntrada" required>
                <option value="">Hora</option>
                <script>
                  for (let i = 0; i <= 23; i++) {
                    document.write(
                      `<option value="${String(i).padStart(2, "0")}">${String(
                        i
                      ).padStart(2, "0")}</option>`
                    );
                  }
                </script>
              </select>

              <select name="minutoEntrada" required>
                <option value="">Minuto</option>
                <script>
                  for (let i = 0; i <= 59; i++) {
                    document.write(
                      `<option value="${String(i).padStart(2, "0")}">${String(
                        i
                      ).padStart(2, "0")}</option>`
                    );
                  }
                </script>
              </select>
            </div>
          </label>
          <span></span>
        </div>

        <label>
          Horário de Saída
          <div style="display: flex; gap: 8px; margin-top: 4px">
            <select name="horaSaida" required>
              <option value="">Hora</option>
              <script>
                for (let i = 0; i <= 23; i++) {
                  document.write(
                    `<option value="${String(i).padStart(2, "0")}">${String(
                      i
                    ).padStart(2, "0")}</option>`
                  );
                }
              </script>
            </select>

            <select name="minutoSaida" required>
              <option value="">Minuto</option>
              <script>
                for (let i = 0; i <= 59; i++) {
                  document.write(
                    `<option value="${String(i).padStart(2, "0")}">${String(
                      i
                    ).padStart(2, "0")}</option>`
                  );
                }
              </script>
            </select>
          </div>
        </label>

        <div class="card">
          <label for="diaDeVencimento">Dia de Pagamento</label>
          <select id="diaDeVencimento" name="diaDeVencimento" required>
            <option value="">Selecione o dia</option>
            <script>
              for (let i = 1; i <= 31; i++) {
                document.write(
                  `<option value="${String(i).padStart(2, "0")}">${String(
                    i
                  ).padStart(2, "0")}</option>`
                );
              }
            </script>
          </select>
          <span></span>
        </div>

 <div class="card">
  <!-- Valor Mensal -->
  <input
    type="text"
    name="mensal"
    placeholder="Valor Mensal R$ 0,00"
    required
    oninput="formatarValor(this); calcularTotal(this)"
  />

  <!-- Número de Parcelas -->
  <input
    type="number"
    name="parcelas"
    placeholder="Nº de Parcelas"
    min="1"
    required
    oninput="calcularTotal(this)"
  />

  <!-- Resultado (Valor Total) -->
  <input
    type="text"
    name="total"
    placeholder="Valor Total R$ 0,00"
    readonly
  />
</div>



        <div class="contrato">
          <section aria-labelledby="contrato-titulo">
            <h2 id="contrato-titulo">Contrato de Transporte Escolar</h2>
            <p>
              Caso ocorra algum imprevisto durante o trajeto da parte
              contratada, como por exemplo acidente, bloqueio de pista, etc.,
              fica estabelecida uma tolerância de 15 (minutos) a contar do
              horário de saída do transporte escolar.
            </p>

            <h3>Cláusulas Contratuais</h3>

            <article aria-labelledby="clausula-primeira-titulo">
              <h4 id="clausula-primeira-titulo">
                Cláusula Primeira: Da Vigência do Contrato
              </h4>
              <p>
                A contratada transportará o/a contratante para a instituição de
                ensino citada acima e no percurso previamente definido. O
                transporte será realizado durante o período de vigência deste
                contrato, que se inicia com data de início mês e ano inseridos
                no site automaticamente, assim como o término com dia mês e ano
                cadastrados no site, sempre e somente em dias úteis (segunda a
                sexta-feira).
              </p>
              <p>
                <strong>Parágrafo 1º:</strong> O transporte não será realizado
                nos feriados, bem como, não será realizado durante períodos de
                segunda chamada, para ver notas após semana de provas e para
                levar até o estágio.
              </p>
            </article>

            <article aria-labelledby="clausula-segunda-titulo">
              <h4 id="clausula-segunda-titulo">
                Cláusula Segunda: Da Remuneração e Do Vencimento
              </h4>
              <p>
                A parte contratante pagará a contratada pelo serviço de
                transporte, o valor será fechado conforme negociação individual.
                Após fechado do serviço, o mesmo se tornará firmado e válido
                mediante preenchimento completo do formulario LEKOTOUR, além de
                realização da assinatura digital, e envio do formulário, através
                do site que será informado no momento da venda do transporte, As
                mensalidades serão divididas em 12 parcelas iguais fixas, sendo
                a primeira parcela paga em 10/02 referente ao ano vigente,
                informado no cadastro digital, ficando aqui estipulado como
                vencimento para as demais parcelas todo dia 10 de cada mês,
                entre o primeiro mês de contrato até o último mês de contrato.
                Os valores mensais e valor total anual deve ser informado
                durante o cadastro no próprio site e o termino do preenchimento
                e envio, aguarde mensagem de confirmação (formulário enviado com
                sucesso).
              </p>
            </article>

            <article aria-labelledby="clausula-terceira-titulo">
              <h4 id="clausula-terceira-titulo">Cláusula Terceira:</h4>
              <p>
                Caso haja recesso ou greve, fica obrigatório o pagamento das
                parcelas nas datas pré-determinadas neste contrato, visto que o
                valor cobrado é referente ao ano letivo.
              </p>
            </article>

            <article aria-labelledby="clausula-quarta-titulo">
              <h4 id="clausula-quarta-titulo">
                Cláusula Quarta: Das Obrigações Da Contratada
              </h4>
              <p>
                A contratada responsabiliza-se pelo transporte do(a) contratante
                definido neste contrato durante todo o período de vigência e
                percurso previamente estabelecido neste documento, utilizando
                veículo em boas condições de uso.
              </p>
            </article>

            <article aria-labelledby="clausula-quinta-titulo">
              <h4 id="clausula-quinta-titulo">Cláusula Quinta:</h4>
              <p>
                A contratada reserva-se ao direito de transferir este contrato a
                um transportador parceiro, de diferente CNPJ, em caso de mudança
                na demanda, seja da região residencial do(a) contratante ou de
                sua instituição de ensino, sem que haja prejuízo a parte
                contratante.
              </p>
            </article>

            <article aria-labelledby="clausula-sexta-titulo">
              <h4 id="clausula-sexta-titulo">
                Cláusula Sexta: Das Obrigações Do Contratante
              </h4>
              <p>
                A ausência do(a) contratante na ida ou na volta da
                Escola/Faculdade, deverá ser comunicada com antecedência a
                contratada, seja via mensagem e/ou telefone.
              </p>
            </article>

            <article aria-labelledby="clausula-setima-titulo">
              <h4 id="clausula-setima-titulo">Cláusula Sétima:</h4>
              <p>
                O contratante/usuário deverá obedecer às seguintes condições no
                transporte:
              </p>
              <p>
                <strong>Parágrafo 1º:</strong> Estar pronto para o embarque no
                local definido para este fim, sempre 5 (cinco) minutos antes do
                horário estipulado;
              </p>
              <p>
                <strong>Parágrafo 2º:</strong> Deverá comportar-se de forma
                adequada, sob pena de incidência do parágrafo 2º da cláusula
                nona;
              </p>
              <p>
                <strong>Parágrafo 3º:</strong> É obrigatório o uso do cinto de
                segurança. Multas pela falta do mesmo serão ressarcidas a
                contratada pelo responsável contratante;
              </p>
              <p>
                <strong>Parágrafo 4º:</strong> O usuário contratante deve manter
                o veículo limpo, não jogar lixo e não colocar os pés nos bancos.
                Caso ocorra o descumprimento será cobrada uma taxa de limpeza
                dividida entre todos os alunos contratantes;
              </p>
              <p>
                <strong>Parágrafo 5º:</strong> Todo e qualquer dano causado pelo
                passageiro(a) contratante no veículo, será de responsabilidade
                do responsável contratante, não havendo prejuízo a contratada.
              </p>
            </article>

            <article aria-labelledby="clausula-nona-titulo">
              <h4 id="clausula-nona-titulo">
                Cláusula Nona: Da Suspensão Do Contrato
              </h4>
              <p>
                A suspensão do referido contrato se dará nas seguintes
                condições:
              </p>
              <p>
                <strong>Parágrafo 1º:</strong> Falta de pagamento no vencimento
                estipulado e acordado entre as partes (caso de atraso no
                pagamento das parcelas haverá tolerância de 15 dias). À partir
                do 16º dia, ocorrerá a suspensão do transporte, sendo este
                reestabelecido somente após a regularização dos valores devidos;
              </p>
              <p>
                <strong>Parágrafo 2º:</strong> Comportamentos inadequados do
                usuário, tais como: colocar cabeça ou braços para fora do
                veículo, arremessar objetos para fora, palavrões, discussões e
                brigas no interior do veículo, descarte de lixo em bancos ou no
                chão do veículo, insistir em andar sem o cinto de segurança,
                pisar com os sapatos nos bancos.
              </p>
              <p>
                <strong>Parágrafo 3º:</strong> Ocorrendo alteração de endereço
                residencial, de Escola/Faculdade ou de turno, diferente do
                trajeto e/ou horário do veículo transportador;
              </p>
              <p>
                <strong>Parágrafo 4º:</strong> Caso ocorra manifestações e
                bloqueios nas estradas que venham impossibilitar a livre
                circulação do veículo, bem como, que coloque em risco a
                segurança das partes contratantes.
              </p>
            </article>

            <article aria-labelledby="clausula-decima-titulo">
              <h4 id="clausula-decima-titulo">
                Cláusula Décima: Da Desistência
              </h4>
              <p>
                No caso de desistência da parte contratante, durante o período
                de vigência deste contrato, ficará estipulado uma multa no valor
                de 10% (dez por cento) sobre o valor das parcelas vincendas do
                contrato.
              </p>
              <p>
                <strong>Parágrafo 1º:</strong> Caso ocorra desistência da parte
                contratante após o mês de Novembro será cobrado 10% da Multa
                referente aos 3 últimos meses do Contrato (Novembro, Dezembro. E
                Janeiro).
              </p>
            </article>

            <article aria-labelledby="clausula-decima-primeira-titulo">
              <h4 id="clausula-decima-primeira-titulo">
                Cláusula Décima Primeira: Do Foro
              </h4>
              <p>
                Fica eleito o foro da Comarca de São José dos Pinhais do Estado
                do Paraná, para dirimir quaisquer dúvidas oriundas do presente
                contrato.
              </p>
            </article>

            <p>
              Assim sendo, assinam o presente contrato em comum acordo, em duas
              vias e de igual teor, para que surtam os efeitos legais para ambas
              as partes.
            </p>
          </section>
        </div>

        <h3>Assinatura Digital</h3>
        <canvas id="assinatura"></canvas>

        <button type="button" onclick="limpar()">
          <a href="#"><span>Limpar</span></a>
        </button>
        <button type="submit">
          <a href="#"><span>Enviar</span></a>
        </button>
      </div>
    </form>

    <script>
      const assinaturaPad = new SignaturePad(
        document.getElementById("assinatura")
      );

      function limpar() {
        assinaturaPad.clear();
      }

      // Função para formatar o valor monetário
      function formatarValor(input) {
        let valor = input.value.replace(/\D/g, ""); // Remove tudo que não é dígito
        if (valor.length === 0) {
          input.value = "";
          return;
        }
        // Garante que haja pelo menos "00" para centavos
        if (valor.length === 1) valor = "00" + valor;
        if (valor.length === 2) valor = "0" + valor;

        valor = (parseInt(valor) / 100).toFixed(2) + ""; // Transforma em float e garante 2 casas decimais
        valor = valor.replace(".", ","); // Troca ponto por vírgula para formato BR
        valor = "R$ " + valor.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1."); // Adiciona pontos de milhar
        input.value = valor;
      }

      document
        .getElementById("formulario")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const form = e.target;
          const dados = Object.fromEntries(new FormData(form));

          if (assinaturaPad.isEmpty()) {
            alert("Por favor, assine antes de enviar.");
            return;
          }

          dados.assinatura = assinaturaPad.toDataURL();

          try {
            const resposta = await fetch(
              "http://localhost:3000/api/inscricoes",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(dados),
              }
            );

            if (resposta.ok) {
              alert("Inscrição enviada com sucesso!");
              form.reset();
              limpar();
            } else {
              const errorData = await resposta.json(); // Tenta ler o JSON de erro
              let errorMessage = "Erro ao enviar. Tente novamente.";
              if (errorData.message) {
                errorMessage = errorData.message;
              }
              if (errorData.errors) {
                // Se o backend enviar um objeto 'errors' com detalhes por campo
                for (const field in errorData.errors) {
                  errorMessage += `\n- ${field}: ${errorData.errors[field]}`;
                }
              }
              alert(errorMessage);
            }
          } catch (error) {
            console.error("Erro na requisição fetch:", error);
            alert(
              "Ocorreu um erro ao tentar se conectar com o servidor. Verifique sua conexão ou tente novamente mais tarde."
            );
          }
        
        
        
        
        
        
        
        });

  function formatarValor(input) {
    let valor = input.value.replace(/\D/g, "");
    valor = (parseInt(valor, 10) / 100).toFixed(2);
    valor = valor.toString().replace(".", ",");
    valor = "R$ " + valor.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    input.value = valor;
  }

  function desformatarValor(valor) {
    return parseFloat(valor.replace(/[^\d,]/g, "").replace(",", ".")) || 0;
  }

  function calcularTotal(elemento) {
    const container = elemento.parentElement;

    const inputMensal = container.querySelector('input[name="mensal"]');
    const inputParcelas = container.querySelector('input[name="parcelas"]');
    const inputTotal = container.querySelector('input[name="total"]');

    const valorMensal = desformatarValor(inputMensal.value);
    const parcelas = parseInt(inputParcelas.value) || 0;

    const total = valorMensal * parcelas;
    const totalFormatado = total.toLocaleString("pt-BR", {
      style: "currency",
      currency: "BRL"
    });

    inputTotal.value = totalFormatado;
  }



        

    </script>
  </body>
</html>
